<!DOCTYPE html>
<html lang="en" id="root" class="light font-['Poppins']">
  <head>
    <script>
      const darkThemeMq = window.matchMedia("(prefers-color-scheme: dark)");
      var root = document.querySelector('#root');
      if (darkThemeMq.matches) {
          console.log(root)
          document.documentElement.classList.remove("light");
          document.documentElement.classList.add("dark");
          console.log(root)
      } else {
          document.documentElement.classList.remove("dark");
          document.documentElement.classList.add("light");
      }
    </script>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <%= csrf_meta_tag() %>
    <%= live_title_tag assigns[:page_title] || "Histora", suffix: "" %>
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
    <link phx-track-static rel="stylesheet" href={Routes.static_path(@conn, "/assets/app.css")}/>
    <script defer src="https://unpkg.com/alpinejs@3.10.2/dist/cdn.min.js"></script>
    <script defer phx-track-static type="text/javascript" src={Routes.static_path(@conn, "/assets/app.js")}></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script defer src="https://unpkg.com/@alpinejs/ui@3.10.3-beta.0/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/@alpinejs/focus@3.10.3/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.10.3/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5VFPTN6XMY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-5VFPTN6XMY');
    </script>
    <!-- Start of HubSpot Embed Code -->
      <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/22733857.js"></script>
    <!-- End of HubSpot Embed Code -->

    <script defer data-domain="histora.app" src="https://plausible.io/js/plausible.js"></script>

  </head>
    <%= if Pow.Plug.current_user(@conn) do %>
      <%= if String.contains?(assigns.conn.request_path, ["/welcome", "/paused"]) do %>
        <body class="marketing flex flex-col bg-white dark:bg-slate font-poppins">
          <%= render "welcome_navigation.html", Map.merge(@conn.assigns, %{conn: @conn}) %>

          <%= @inner_content %>
        </body>
      <% else %>
        <body class="mr-0.5 ml-0.5 flex flex-row dark:bg-slate font-poppins ">
          <%= render "navigation.html", Map.merge(@conn.assigns, %{conn: @conn}) %>
          <%= render "inner_navigation.html", Map.merge(@conn.assigns, %{conn: @conn}) %>

          <div class="container pl-5 pr-7">
            <%= if assigns.conn.request_path != "/" do %>
              <%= render "action_bar.html", Map.merge(@conn.assigns, %{conn: @conn}) %>
            <% end %>
            <%= @inner_content %>
          </div>

        </body>
      <% end %>
    <% else %>
      <body class="marketing flex flex-col bg-white dark:bg-slate font-poppins">
          <%= render "marketing_navigation.html", Map.merge(@conn.assigns, %{conn: @conn}) %>
          <div class="flex flex-col items-center justify-start">
            <p class="text-blue" role="alert"><%= get_flash(@conn, :info) %></p>
            <p class="text-red" role="alert"><%= get_flash(@conn, :error) %></p>
          </div>
          <%= @inner_content %>
      </body>
    <% end %>
</html>
